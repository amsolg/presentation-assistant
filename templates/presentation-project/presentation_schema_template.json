{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Presentation Builder Schema",
  "description": "Schema pour définir une présentation avec l'architecture JSON",
  "type": "object",
  "required": ["presentation_name", "subject", "audience", "slides", "output_path"],
  "properties": {
    "presentation_name": {
      "type": "string",
      "description": "Nom de la présentation"
    },
    "subject": {
      "type": "string",
      "description": "Sujet de la présentation (pour navigation dans presentations/[sujet]/)"
    },
    "audience": {
      "type": "string",
      "description": "Audience cible (pour navigation dans presentations/[sujet]/[audience]/)"
    },
    "output_path": {
      "type": "string",
      "description": "Chemin de sortie pour la présentation générée",
      "pattern": "^.+\\.pptx$"
    },
    "slides": {
      "type": "array",
      "description": "Liste des slides basées sur les templates slide-structure. Chaque slide utilise un template spécifique (1-57) avec contenu personnalisé.",
      "items": {
        "type": "object",
        "description": "Configuration d'une slide basée sur les templates slide-structure",
        "required": ["slide_number"],
        "properties": {
          "slide_number": {
            "type": "integer",
            "minimum": 1,
            "maximum": 57,
            "description": "Numéro du template de slide à utiliser (1-57) correspondant aux fichiers slide-structure"
          },
          "layout_name": {
            "type": "string",
            "description": "Nom du layout de la slide (référence, extrait automatiquement du template)"
          },
          "shapes": {
            "type": "array",
            "description": "Modifications des shapes de la slide selon la structure slide-structure",
            "items": {
              "type": "object",
              "required": ["shape_id"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Nom du shape (pour référence)"
                },
                "shape_id": {
                  "type": "integer",
                  "description": "ID du shape à modifier (correspond au shape_id dans slide-structure)"
                },
                "type": {
                  "type": "string",
                  "enum": ["placeholder", "shape"],
                  "description": "Type de shape (placeholder ou shape)"
                },
                "position": {
                  "type": "object",
                  "description": "Position du shape (optionnel, pour référence)",
                  "properties": {
                    "left": {"type": "number"},
                    "top": {"type": "number"},
                    "width": {"type": "number"},
                    "height": {"type": "number"}
                  }
                },
                "placeholder_type": {
                  "type": "string",
                  "enum": ["body", "title", "ctrTitle"],
                  "description": "Type de placeholder (si applicable)"
                },
                "placeholder_idx": {
                  "type": "integer",
                  "description": "Index du placeholder (si applicable)"
                },
                "text": {
                  "type": "string",
                  "description": "Nouveau texte pour ce shape"
                },
                "font_name": {
                  "type": "string",
                  "description": "Police du texte (Premier Tech utilise: Premier Tech Text, Premier Tech Title, Premier Tech Title Bold)"
                },
                "font_size": {
                  "type": "number",
                  "minimum": 8,
                  "maximum": 144,
                  "description": "Taille de police (Premier Tech utilise: 18, 20, 24, 28, 32, 44, 48, 54, 60, 66)"
                },
                "bold": {
                  "type": "boolean",
                  "description": "Texte en gras"
                },
                "italic": {
                  "type": "boolean",
                  "description": "Texte en italique (Premier Tech n'utilise jamais)"
                },
                "underline": {
                  "type": "boolean",
                  "description": "Texte souligné (Premier Tech n'utilise jamais)"
                },
                "color": {
                  "type": "string",
                  "pattern": "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$",
                  "description": "Couleur du texte (format hex). Premier Tech utilise: #FFFFFF, #41B6E6, #BDBDBD"
                },
                "alignment": {
                  "type": "string",
                  "enum": ["LEFT", "CENTER", "RIGHT"],
                  "description": "Alignement horizontal du texte"
                },
                "vertical_alignment": {
                  "type": "string",
                  "enum": ["TOP", "MIDDLE", "BOTTOM"],
                  "description": "Alignement vertical (Premier Tech utilise exclusivement TOP)"
                },
                "margin_left": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Marge gauche (Premier Tech utilise: 7.2, 8.5)"
                },
                "margin_right": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Marge droite (Premier Tech utilise: 7.2, 8.5)"
                },
                "margin_top": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Marge haut (Premier Tech utilise: 3.6, 5.67)"
                },
                "margin_bottom": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Marge bas (Premier Tech utilise: 3.6, 5.67)"
                },
                "text_wrapping": {
                  "type": "string",
                  "enum": ["square", "none", "top-bottom", "tight"],
                  "description": "Type d'habillage du texte (Premier Tech utilise exclusivement 'square')"
                },
                "autofit": {
                  "type": "object",
                  "description": "Configuration d'ajustement automatique",
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["none", "normal", "resize"],
                      "description": "Type d'autofit (Premier Tech utilise 98.2% 'none', 1.8% 'normal')"
                    },
                    "font_scale": {
                      "type": ["number", "null"],
                      "description": "Échelle de police"
                    },
                    "line_spacing_reduction": {
                      "type": ["number", "null"],
                      "description": "Réduction espacement lignes"
                    }
                  }
                }
              }
            }
          },
          "total_shapes": {
            "type": "integer",
            "description": "Nombre total de shapes (référence)"
          },
          "description": {
            "type": "string",
            "description": "Description optionnelle de cette slide pour documentation"
          }
        }
      }
    },
    "build_options": {
      "type": "object",
      "description": "Options globales de construction",
      "properties": {
        "base_template": {
          "type": "string",
          "default": "templates/Template_PT.pptx"
        },
        "auto_widen_text": {
          "type": "boolean",
          "default": true
        },
        "generate_reports": {
          "type": "boolean",
          "default": true
        },
        "preserve_styles": {
          "type": "boolean",
          "default": true
        }
      }
    }
  }
}